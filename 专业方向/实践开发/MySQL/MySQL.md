# MySQL体系结构

![image-20221101101912394](D:\文档\学习笔记\专业方向\MySQL\MySQL.assets\image-20221101101912394.png)



# 存储引擎



## InnoDB存储引擎

主要面向在线事务处理(OLTP)的应用。

### 特点

* 行锁设计。
* 支持外键。
* 支持类似于Oracle的非锁定读。
* 从MySQL4.1开始，可以将每个表单独存放到一个独立的ibd文件中。
* 支持用裸设备用来建立其表空间。
* 通过使用多版本并发控制(MVCC)来获得高并发性。
* 实现了SQL标准的4中隔离级别，默认为REPEATABLE(可重复读)。
* 使用一种被称为next-key locking的策略来避免幻读现象的产生。
* 提供插入缓冲、二次写、自适应哈希索引、预读等高性能和高可用的功能。



## MyISAM存储引擎

主要面向一些OLAP(百度了一下，是在写分析处理的意思，即用于数据分析吧)。

### 特点

* 不支持事务、表锁设计（数据库系统和文件系统很大的一个不同之处在于对事务的支持）。
* 支持全文索引。
* 缓冲池只缓冲索引文件，不缓冲数据文件，和大多数的数据库都非常不同（数据文件的缓存交由操作系统本身来完成）。
* 存储引擎表由MYD和MYI组成，MYD用来存放数据文件，MYI用来存放索引文件。
* 可通过myisampack工具进一步压缩数据文件，但因为此工具使用赫夫曼编码静态算法来压缩数据，因此压缩后的表是只读的。



## NDB存储引擎

是一个集群存储引擎，类似于Oracle的RAC集群，与Oracle RAC share everything架构不同的是，其结构是share nothing的集群架构，因此能提供更高的可用性。

### 特点

* 数据全部放在内存中（从MySQL5.1版本开始，可将非索引数据放在磁盘上），因此主键查找的速度极快。
* 通过添加NDB存储节点可以先行地提高数据库性能，是高可用、高性能的集群系统。
* NDB存储引擎的连接操作（JOIN）实在MySQL数据库层完成的，而不是在存储引擎层完成的。这意味着，复杂的连接操作需要巨大的网络开销，因此查询操作很慢。



## Memory存储引擎

原HEAP存储引擎，非常适合用于存储临时数据的临时表，以及数据仓库中的纬度表。

### 特点

* 将表中的数据存放在内存中，如果数据库重启或发生崩溃，表中的数据都将消失。
* 默认使用哈希索引，而不是B+树索引。
* 虽然此引擎速度非常快，但还是有一些限制，比如只支持表锁，并发性能差，不支持TEXT和BLOB列类型。
* 存储变长字段（varchar）时是按照定长字段（char）的方式进行的，因此会浪费内存。







# MySQL的数据目录



## InnoDB存储引擎



### MySQL5.7

* 使用db.opt存储数据库的相关配置。
* 使用table.frm文件存储表的结构。
* 5.6.6版本之后默认使用独立表空间：table.idb存储表数据，可以通过配置使用系统表空间。
* 5.6.6版本之前使用系统表空间：ibdata1中存储所有表的数据。

### MySQL8.0

* 不在提供db.opt存储数据库相关配置。
* 不再提供table.frm文件存储表结构，而是和数据一起存储在table.idb文件中。



## MyISAM

共同点：使用table.MYD文件存储数据，使用table.MYI文件存储索引信息。

### MySQL5.7

* 使用table.frm文件存储表结构。

### MySQL8.0

* 使用table.xxx.sdi文件存储表结构。





# 索引

## 二级索引

注意：在二级索引的非叶子节点中也需要存放主键，这是因为在二级索引的字段相同时，要根据主键字段来进行区分。
